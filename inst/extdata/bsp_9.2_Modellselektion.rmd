---
title:  "Onlinebeispiel 9.2: Modellselektion mithilfe von AIC-Werten für zwei benachbarte geschlossene Populationen des baumbewohnenden Geckos *Gehyra variegata*"
subtitle: "Kapitel 9 aus Henle, K., A. Grimm-Seyfarth & B. Gruber: Erfassung und Analyse von Tierpopulationen. Ulmer Verlag"
author: "Annegret Grimm-Seyfarth"
date: "05.04.2025"
output:
  pdf_document: 
  word_document: default
  html_document:
    self_contained: no
    df_print: paged
  latex_engine: xelatex
header-includes:
  - \usepackage{amssymb}
  - \usepackage[none]{hyphenat} 
  - \newlength{\hanglen}
  - \setlength{\hanglen}{0.5cm}
  - \newenvironment{hangparagraph}{\par\hangindent=\hanglen \hangafter=1}{\par}
editor_options:
  chunk_output_type: inline
  markdown:
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
knitr::opts_chunk$set(width = 80)
options(width = 80)
```

Im Kinchega Nationalpark befinden sich zwei räumlich getrennte, benachbarte Geckopopulationen, welche 2016 an sieben (Auwaldgebiet, RI) bzw. sechs (Feldstation, Station) Tagen in Folge mittels Fang-Markierung-Wiederfang-Methode untersucht wurden. Wir wissen, dass es keine konstante Fangwahrscheinlichkeit gibt (Beispiel 10.5), sondern individuelle Heterogenität vorliegt (Henle 1990, Grimm et al. 2014, Grimm-Seyfarth et al. 2018). Anhand des Studiendesigns – Fang am Ende der Reproduktionssaison (d. h., keine neuen Individuen durch Geburten), nur wenige Tage andauernde Primärperiode (d. h., keine Zu- und Abwanderungen sowie vernachlässigbare Mortalität erwartet) – gehen wir von einer geschlossenen Population aus. Während die Feldstation räumlich ohnehin geschlossen ist, was Zu- und Abwanderung in wenigen Tagen unwahrscheinlich macht, untersuchten wir in der Auwaldpopulation zusätzlich 19 umliegende Bäume, um wandernde Individuen zu entdecken. Dabei werden Individuen, die mindestens einmal im Kerngebiet erfasst werden, dem Kerngebiet hinzugeschlagen, während Individuen, die ausschließlich an den 19 umliegenden Bäumen entdeckt werden, nicht zur Population gerechnet werden. Somit können wir in unserem Design bereits sicherstellen, dass die Population geschlossen ist. Von beiden Populationen haben wir nun die Fanggeschichte analog zu Tabelle 9.1 des Buches erstellt.

Für die beiden Onlinebeispiele 9.1 und 9.2 nutzen wir das R-Paket secr (Efford 2025). Der Beginn ist hier daher identisch mit Onlinebeispiel 9.1.

```{r}
# check.packages function: install and load multiple R packages.
# Function from: https://gist.github.com/smithdanielle/9913897
check.packages <- function(pkg){
  new.pkg <- pkg[!(pkg %in% installed.packages()[, "Package"])]
  if (length(new.pkg)) 
    install.packages(new.pkg, dependencies = TRUE, type = "source")
  sapply(pkg, require, character.only = TRUE)
}

# benoetigte R pakete
pakete <- c("secr")

# Pruefe und installiere
check.packages(pakete)
```

Weitere Informationen zur Nutzung des Paketes finden sich hier:

\url{https://cran.r-project.org/web/packages/secr/secr.pdf}

# Einlesen der Fangdaten
Wir laden zunächst die Fangdaten der beiden Gebiete ein. Das secr-Paket nutzt räumlich explizite Daten. Da wir hier nicht darauf eingehen, nutzen wir nur einen Detektor. Genaue Infos, wie man verschiedene Detektortypen einliest, finden sich hier: \url{https://cran.r-project.org/web/packages/secr/vignettes/secr-datainput.pdf}

```{r}
# Daten von Auwaldgebiet (RI) einlesen
UlmerBuch::beispiel.pfad()
xlsname <- "GV_RI_2016.xlsx"
CH.RI <- read.capthist (xlsname, sheet = c("GVRIcapt", "GVRItrap"), skip = 1,
detector = "count")
summary(CH.RI)

# Daten von Feldstation (Station) einlesen
xlsname <- "GV_Station_2016.xlsx"
CH.Station <- read.capthist (xlsname, sheet = c("GVScapt", "GVStrap"), skip = 1,
detector = "count")
summary(CH.Station)
```

# Modellwahl
Aufgrund der Vielzahl möglicher Methoden, um Populationsgrößen einer geschlossenen Population zu schätzen, muss eine Wahl zwischen verschiedenen Modellen getroffen werden. Das Paket secr bietet eine Selektion basierend auf dem Akaike-Informationskriterium (AIC). Hierbei werden zahlreiche Modelle gerechnet und ein AIC erstellt. Dies funktioniert für die Maximum-Likelihood-Schätzer  M0 (`null`), Mb removal nach Zippin (`zippin`, Otis et al. 1978 p.108), Mt nach Darroch (`darroch`, Otis et al. 1978 p.106--7), Mh Pledgers endlich gemischte Modelle (`h2`, Pledger 2000), und Mh Beta-binomiale kontinuierliche gemischte Modelle (`betabinomial`, Dorazio & Royle 2003). 
Weitere Modelle, die berechnet werden können, jedoch keinen AIC Wert produzieren können, sind Mh Jackknife (`jackknife`, Burnham & Overton 1978), Chao’s Mh-Schätzer (`chao`, Chao 1987), Chao's modifizierter Mh-Schätzer (`chaomod`, Chao 1987), sowie die Sample-Coverage-Schätzer 1 und 2 (`chao.th1`/`chao.th2`, Lee & Chao 1994). Eine detaillierte Beschreibung der Schätzmethoden findet sich in Kap. 10.3 des Buches.

## Population RI
Wir schätzen die Populationsgröße zunächst für die RI Population:
```{r}
closedN(CH.RI)
```
Die Ergebnisstabelle zeigt zunächst die verschiedenen Schätzer wie oben beschrieben, dann das zugehörige Modell, die Anzahl Parameter (bei parametrischen Methoden), die negative Log-Likelihood, den AIC sowie AICc (d. h., AIC korrigiert für kleine Stichprobengrößen - bei ausreichend großen Stichproben nähern sich beide Werte annähernd identisch an), die Differenz der AICc-Werte zum besten Modell (d. h., das Modell mit dem geringsten AICc) sowie einer AICc-Wichtung (je höher, umso besser ist das Modell). Schließlich finden wir unter `Nhat` die geschätzte Populationsgröße, deren Standardfehler (`seNhat`), sowie das untere (`lcINhat`) und obere Konfidenzintervall der geschätzten Populationsgröße (`ucINhat`).

Wie zu erwarten, haben die Mh-Modelle am besten geschätzt und weisen die geringsten AIC(c)-Werte auf, folglich liegt individuelle Heterogenität in der Fängigkeit vor. Die Wahl sollte daher auf einen der Mh-Schätzer fallen, die sich, mit einer Ausnahme, nicht gravierend voneinander unterscheiden. Weitere Entscheidungshinweise für die verschiedenen Mh-Modelle geben Grimm et al. (2014). Würden wir diese individuelle Heterogenität nicht berücksichtigen, würde die Populationsgröße stark unterschätzt werden, wie die Ergebnisse der anderen Schätzer zeigen.

## Population Station
Schauen wir uns noch die Population an der Station an:
```{r}
closedN(CH.Station)
```
Auch hier sind die Mh-Modelle deutlich am besten und weisen die geringsten AIC(c)-Werte auf. Der Unterschied zu weiteren Modellen ist hier allerdings ungleich größer als in der RI-Population. Auch dies unterstreicht nochmals, dass die individuelle Heterogenität in dieser Population deutlich stärker ausgeprägt sein muss. Auch hier würde ein Nicht-Beachten der individuellen Heterogenität zu einer massiven Unterschätzung der tatsächlichen Populationsgröße führen.

# Literaturverzeichnis
\begin{hangparagraph}
Burnham, K.P., Overton, W.S. (1978): Estimating the size of a closed population when capture probabilities vary among animals. --- Biometrika 65: 625–-633.
\end{hangparagraph}

\begin{hangparagraph}
Chao, A. (1987): Estimating the population size for capture–recapture data with unequal catchability. --- Biometrics 43: 783–-791.
\end{hangparagraph}

\begin{hangparagraph}
Dorazio, R.M., Royle, J.A. (2003): Mixture models for estimating the size of a closed population when capture rates vary among individuals. --- Biometrics 59: 351–-364.
\end{hangparagraph}

\begin{hangparagraph}
Efford, M.G. (2025): secr: Spatially explicit capture-recapture models. R package version 5.2.1.  \url{https://CRAN.R-project.org/package=secr}
\end{hangparagraph}
  
\begin{hangparagraph}
Grimm, A., Gruber, B., Henle, K. (2014): Reliability of different mark-recapture methods for population size estimation tested against reference population sizes constructed from field data. --- Plos One 9: e98840.
\end{hangparagraph}

\begin{hangparagraph}
Grimm-Seyfarth, A., Mihoub, J.-B., Gruber, B., Henle, K. (2018): Some like it hot: From individual to population responses of an arboreal arid-zone gecko to local and distant climate. --- Ecological Monographs 88: 336–-352.
\end{hangparagraph}

\begin{hangparagraph}
Henle, K. (1990): Population ecology and life history of the arboreal gecko \textit{Gehyra variegata} in arid Australia. --- Herpetological Monographs 4: 30–-60.
\end{hangparagraph}

\begin{hangparagraph}
Lee, S.-M., Chao, A. (1994): Estimating population size via sample coverage for closed capture-recapture models. --- Biometrics 50: 88–-97.
\end{hangparagraph}

\begin{hangparagraph}
Otis, D.L., Burnham, K.P., White, G.C., Anderson, D.R. (1978): Statistical inference from capture data on closed animal populations. --- Wildlife Monographs 62: 1–-135.
\end{hangparagraph}

\begin{hangparagraph}
Pledger, S. (2000): Unified maximum likelihood estimates for closed capture-recapture models using mixtures. --- Biometrics 56: 434–-442.
\end{hangparagraph}
