---
title: "Onlinebeispiel 4.5 Berechnung der Anzahl benötigter Erfassungen, um eine vorgegebene Nicht-Vorkommenswahrscheinlichkeit zu erreichen "
subtitle: "Kapitel 4.3 aus Henle, K., A. Grimm-Seyfarth & B. Gruber: Erfassung und Analyse von Tierpopulationen. Ulmer Verlag"
author: "Bernd Gruber"
date: 11.10.2022
output:
  pdf_document: 
  word_document: default
  html_document:
    self_contained: no
    df_print: paged
  latex_engine: xelatex
header-includes:
  - \usepackage{amssymb}
  - \usepackage[none]{hyphenat} 
  - \newlength{\hanglen}
  - \setlength{\hanglen}{0.5cm}
  - \newenvironment{hangparagraph}{\par\hangindent=\hanglen \hangafter=1}{\par}
editor_options:
  chunk_output_type: inline
  markdown:
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
knitr::opts_chunk$set(width = 80)
options(width = 80)
```

# Benötigte Erfassung für Fehlnachweise bei unbekannter \newline Vorkommenswahrscheinlichkeit

## Formel zur Berechnung der benötigten Begehungen (*n*)
Für die Berechnung der benötigten Begehungen benötigen wir die folgenden Parameter:

* $\psi'$ a priori angenommene Vorkommenswahrscheinlichkeit (`psi.prime` im Code)

* $p'$ Nachweiswahrscheinlichkeit für ein Gebiet bei einer Begehung (`p.prime`)

* $\psi'$ 'gewünschte Sicherheit' der Nicht-Vorkommenswahrscheinlichkeit (`psi`)

* $n$ Anzahl notwendiger Begehungen

Schreiben wir nun die Formel 3 aus Wintle et al. (2012) als R-Funktion:
```{r}
# Formel 3 in Wintle et al. (2012)
anb <- function(psi.prime=0.25, psi=0.95, p.prime=0.5, text=FALSE)

{
n <- (log((1-psi)/(psi))-log(psi.prime/(1-psi.prime)))/log(1-p.prime)
if (text) {cat(paste0("Es werden ",format(round(n,3), decimal.mark = ",",
nsmall = 2)," Begehungen benötigt, um zu ",psi*100," % sicher zu sein, dass die Art
nicht vorkommt.", "\n", "Die Nachweiswahrscheinlichkeit betrug ",
format(p.prime, decimal.mark = ",",nsmall = 2)," und die a-priori 
Vorkommenswahrscheinlichkeit wurde mit ", format(psi.prime, decimal.mark = ",",
nsmall = 2)," angenommen."))
  invisible(n)} else return(n)
}
#Beispiel Wintle
anb(psi.prime = 0.25, psi=0.95, p.prime = 0.5, text = TRUE)

```

Zum Ausprobieren können wir weitere Werte in die Funktion eingeben:

```{r}
anb(psi.prime = 0.1, psi=0.99, p.prime = 0.3, text = TRUE)

```

## Plots für verschiedene angenommene a-priori Vorkommenswahrscheinlichkeiten
Um einen besseren Überblick zu bekommen, wie sich die Anzahl notwendiger Begehungen mit der Vorkommenswahrscheinlichkeit sowie der Nachweiswahrscheinlichkeit ändern, stellen wir sie hier exemplarisch grafisch dar (Wintle et al. 2012):

```{r}
# Plot Wintle et al. (2012)
psi.primes <- seq(0.1,0.9,0.01)
p.prime <- 0.5
psi <- 0.95

n <- anb(psi.prime = psi.primes, psi=psi, p.prime = p.prime)

{plot(psi.primes, n, xaxt = "n",
      xlab=expression(paste("a-priori Vorkommenswahrscheinlichkeit (",italic(psi),"')")),
      ylab=expression(paste("Notwendige Begehungen (",italic(n),")")), 
        type="l", ylim=c(0,60))
axis(1, at = c(0.2, 0.4, 0.6, 0.8), labels = c("0,2","0,4","0,6","0,8"))
lines(psi.primes, anb(psi.prime = psi.primes, psi=psi, p.prime = 0.1), lty=3, type="l")
lines(psi.primes, anb(psi.prime = psi.primes, psi=psi, p.prime = 0.3), lty=2, type="l")
legend("topleft", legend=c("0,5","0,3","0,1"), lty= c(1,2,3), 
       title = expression(paste(italic("p'"))))
}
```
Wir können die gewünschte Sicherheit auch auf 99 % erhöhen:
```{r}
# Plot nach Wintle et al. (2012) aber mit psi=0.99 
# gewünschte Sicherheit beträgt 99 %
psi.primes <- seq(0.1,0.9,0.01)
p.prime <- 0.5 #auch linien fuer 0.1 und 0.3
psi <- 0.99

n <- anb(psi.prime = psi.primes, psi=psi, p.prime = p.prime)
#par(mar = c(5.1, 6, 4.1, 2.1))
{plot(psi.primes, n, xaxt = "n",
      xlab=expression(paste("a-priori Vorkommenswahrscheinlichkeit (",italic(psi),"')")),
      ylab=expression(paste("Notwendige Begehungen (",italic(n),")")), 
        type="l", ylim=c(0,70))
axis(1, at = c(0.2, 0.4, 0.6, 0.8), labels = c("0,2","0,4","0,6","0,8"))
lines(psi.primes, anb(psi.prime = psi.primes, psi=psi, p.prime = 0.1), lty=3, type="l")
lines(psi.primes, anb(psi.prime = psi.primes, psi=psi, p.prime = 0.3), lty=2, type="l")
legend("topleft", legend=c("0,5","0,3","0,1"), lty= c(1,2,3), 
       title = expression(paste(italic("p'"))))
}
```

# Literaturverzeichnis
\begin{hangparagraph}
Wintle, B.A., Walshe, T.V., Parris, K.M., McCarthy, M.A. (2012): Designing occupancy surveys and interpreting non-detection when observations are imperfect. --- Diversity and Distributions 18: 417--424.
\end{hangparagraph}
